## Event Manager

-----

## Обзор и Идея Проекта

**Название Проекта:** Event Manager (Сервер Событий и Фронтенд)

**Описание Идеи:** Проект представляет собой веб-приложение для управления событиями. Пользователи могут просматривать ленту событий, создавать новые события и регистрироваться на них. Система состоит из двух основных частей: **Бэкенд-сервера** на **Go**, который управляет данными (событиями и регистрациями), и **Фронтенд-сервера** на **Go**, который предоставляет статические файлы и служит прокси для взаимодействия с Бэкендом.

### Базовый Бизнес-Процесс (User Flow)

1.  **Просмотр Событий (Feed):**
      * Пользователь заходит на главную страницу `/` или `/feed`.
      * Фронтенд запрашивает список событий у Бэкенда.
      * Бэкенд возвращает список событий из базы данных.
      * Фронтенд отображает события в виде ленты, с возможностью поиска по описанию/названию и фильтрации по тегам.
2.  **Создание События (Creation):**
      * Пользователь переходит на страницу `/create`.
      * Заполняет форму (Название, Описание, Теги, Дата).
      * Фронтенд отправляет `POST` запрос на свой API, который проксирует его на Бэкенд.
      * Бэкенд сохраняет новое событие в базе данных.
3.  **Регистрация на Событие (Registration):**
      * *(В текущем фронтенде отсутствует UI для регистрации, но ручка реализована на бэкенде)*.
      * Пользователь (или другая система) отправляет запрос на регистрацию, указывая `event_id`, `user_name` и `email`.
      * Бэкенд проверяет наличие события.
      * Бэкенд сохраняет регистрацию, гарантируя, что один email может быть зарегистрирован на одно событие только один раз (`UNIQUE(event_id, email)`).

-----

## Архитектура Приложения

Приложение использует **Микросервисную Архитектуру** с двумя основными компонентами, взаимодействующими через HTTP, и отдельной базой данных.

### Компоненты

1.  **Frontend (Go/HTML/CSS/JS)**:
      * **Технологии:** Go (статик-сервер и прокси), HTML/CSS/JavaScript (клиентская часть).
      * **Назначение:** Обслуживает статические файлы (`.html`, `.css`, `.js`) и обрабатывает логику маршрутизации для пользовательского интерфейса.
      * **Взаимодействие:** Действует как **прокси-сервер** для запросов `GET /api/events` и `POST /api/events`, перенаправляя их на Бэкенд. Работает на порту **:8081**.
2.  **Backend (Go)**:
      * **Технологии:** Go, Gorilla Mux (роутер), `github.com/lib/pq` (драйвер PostgreSQL).
      * **Назначение:** **API-сервер**, который управляет бизнес-логикой и взаимодействием с базой данных (CRUD для событий и регистраций).
      * **Взаимодействие:** Получает запросы от Фронтенда (через прокси) и других клиентов. Работает на порту **:8080**.
3.  **PostgreSQL Database (DB)**:
      * **Назначение:** Хранилище данных для событий и регистраций.

### Настройки Среды

| Компонент | Порт | Переменные Окружения (EN) | Описание |
| :--- | :--- | :--- | :--- |
| **Backend** | `8080` | `POSTGRES_HOST`, `POSTGRES_PORT`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB` | Настройки подключения к БД. |
| **Frontend** | `8081` | `BACKEND_HOST`, `BACKEND_PORT` | Настройки подключения к Бэкенду. |

-----

## Схема Базы Данных (БД)

База данных **PostgreSQL** содержит две таблицы: `events` для хранения информации о событиях и `registrations` для связи пользователей с событиями.

### Таблица: `events` (События)

| Поле | Тип Данных SQL | Модель Go (`models.Event`) | Описание |
| :--- | :--- | :--- | :--- |
| **id** | `SERIAL PRIMARY KEY` | `int` | Уникальный идентификатор события. |
| **name** | `VARCHAR(255) NOT NULL` | `string` | Название события (обязательное). |
| **description** | `TEXT` | `string` | Подробное описание. |
| **tags** | `TEXT ARRAY` | `[]string` | Массив тегов для категоризации. |
| **date** | `TIMESTAMP` | `string` | Дата и время проведения события. |
| **created\_at** | `TIMESTAMP DEFAULT CURRENT_TIMESTAMP` | (Нет в модели) | Дата создания записи. |

### Таблица: `registrations` (Регистрации)

| Поле | Тип Данных SQL | Модель Go (`models.Registration`) | Описание |
| :--- | :--- | :--- | :--- |
| **id** | `SERIAL PRIMARY KEY` | `int` | Уникальный идентификатор регистрации. |
| **event\_id** | `INTEGER REFERENCES events (id) ON DELETE CASCADE` | `int` | Внешний ключ, связанный с событием. Каскадное удаление. |
| **user\_name** | `VARCHAR(255) NOT NULL` | `string` | Имя зарегистрированного пользователя. |
| **email** | `VARCHAR(255) NOT NULL` | `string` | Email пользователя (обязательное). |
| **created\_at** | `TIMESTAMP DEFAULT CURRENT_TIMESTAMP` | `time.Time` | Дата регистрации. |
| **UNIQUE (event\_id, email)** | Ограничение | | Гарантирует, что один email может быть зарегистрирован на одно событие только один раз. |

-----

## Документация API Бэкенда

Сервер Бэкенда работает на порту **:8080** и предоставляет API для управления событиями и регистрациями.

**Базовый URL:** `http://<backend_host>:8080`

### 1\. События (`/events`)

| Метод | Путь | Назначение |
| :--- | :--- | :--- |
| **POST** | `/events` | Создать новое событие. |
| **GET** | `/events` | Получить список всех событий (отсортированных по дате). |
| **PUT** | `/events/{event_id}` | Обновить существующее событие по его ID. |
| **DELETE** | `/events` | **Удалить все события.** |

#### **POST /events** (Создать Событие)

| Параметр | Расположение | Тип | Обязательный | Описание | Пример |
| :--- | :--- | :--- | :--- | :--- | :--- |
| body | JSON | `Event` | Да | Объект события. | `{ "name": "Hackathon", "description": "...", "tags": ["tech"], "date": "2025-10-30T10:00:00Z" }` |
| **Ответ 201 Created:** Созданное событие с присвоенным `id`.
| **Ответ 400 Bad Request:** Если `name` отсутствует или некорректный JSON.

#### **GET /events** (Получить Все События)

| Параметр | Расположение | Тип | Обязательный | Описание |
| :--- | :--- | :--- | :--- | :--- |
| (нет) | | | | |
| **Ответ 200 OK:** Массив объектов `Event`.

#### **PUT /events/{event\_id}** (Обновить Событие)

| Параметр | Расположение | Тип | Обязательный | Описание |
| :--- | :--- | :--- | :--- | :--- |
| `event_id` | Path | Integer | Да | ID события для обновления. |
| body | JSON | `Event` | Да | Обновленные данные события. |
| **Ответ 200 OK:** Обновленный объект `Event`.
| **Ответ 400 Bad Request:** Некорректный `event_id` или JSON.
| **Ответ 404 Not Found:** Событие с таким ID не найдено.

#### **DELETE /events** (Удалить Все События)

| Параметр | Расположение | Тип | Обязательный | Описание |
| :--- | :--- | :--- | :--- | :--- |
| (нет) | | | | |
| **Ответ 200 OK:** Объект с сообщением об успехе и количеством удаленных строк (`rows_deleted`). **ВНИМАНИЕ: Удаляет ВСЕ события.**

### 2\. Регистрация (`/register`)

| Метод | Путь | Назначение |
| :--- | :--- | :--- |
| **PUT** | `/register/{event_id}` | Зарегистрировать пользователя на событие. |

#### **PUT /register/{event\_id}** (Зарегистрироваться)

| Параметр | Расположение | Тип | Обязательный | Описание | Пример |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `event_id` | Path | Integer | Да | ID события, на которое регистрируется пользователь. |
| body | JSON | `Registration` | Да | Имя и email пользователя. | `{ "user_name": "Anna", "email": "anna@example.com" }` |
| **Ответ 201 Created:** Созданный объект `Registration`.
| **Ответ 400 Bad Request:** Некорректный `event_id`, JSON, или если не указаны `user_name`/`email`.
| **Ответ 404 Not Found:** Событие с таким ID не найдено.
| **Ответ 409 Conflict:** Пользователь с таким email уже зарегистрирован на это событие.

-----

## Дополнительная Информация

### Dockerfile (Бэкенд)

Сборка выполняет скачивание зависимостей (`go mod download`), сборку исполняемого файла (`go build -o main .`) и запускает его. Используется минималистичный базовый образ `golang:1.23-alpine` для уменьшения размера итогового образа.

```dockerfile
FROM golang:1.23-alpine
WORKDIR /app
# ...
RUN go build -o main .
EXPOSE 8080
CMD ["./main"]
```
